#!/bin/bash
deldog () {
	RESULT=$(curl -sf --data-binary @"${1:--}" https://del.dog/documents)  || {
		echo "ERROR: failed to post document" >&2
		return 1
	}
	KEY=$(printf  "%s\n" "${RESULT}" | cut -d '"' -f6)
	echo "https://del.dog/${KEY}"
}

cd /tmp/rom
rm -rf .repo &
. build/envsetup.sh
lunch aosp_mido-user
export CCACHE_DIR=/tmp/ccache
export CCACHE_EXEC=$(which ccache)
export USE_CCACHE=1
ccache -M 20G
ccache -o compression=true
ccache -z
#make api-stubs-docs || echo sorry
#make hiddenapi-lists-docs || echo sorry
#make system-api-stubs-docs || echo sorry
#make test-api-stubs-docs || echo sorry
make aex || deldog out/error.log
#sleep 100m
#kill $(pidof soong_ui)
#kill $(pidof make)
ccache -s
